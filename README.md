# MaxiClone - User Service

This is the **User Service** for the MaxiClone application. The User Service handles all user-related functionalities, including user management, authentication, password reset, and more. It is built using a microservices architecture and follows hexagonal design principles to ensure scalability and maintainability.

## Table of Contents

1. [Overview](#overview)
2. [Tech Stack](#tech-stack)
3. [Setup](#setup)
4. [Endpoints](#endpoints)
    - [User Management](#user-management)
    - [Reset Password](#reset-password)
5. [Security](#security)
6. [Future Improvements](#future-improvements)

## Overview

The **User Service** is responsible for managing users across different roles, handling authentication, and supporting functionalities like password reset. Users are categorized into four roles:
- `STORE`
- `SUPERVISOR`
- `WAREHOUSE`
- `ADMINISTRATOR`

### Core Functionalities
- **CRUD Operations** for users.
- **Role-Based Access Control**.
- **Password Reset** through email with an autogenerated authentication code.
- **JWT Authentication** integration.

## Tech Stack

- **Java 22**
- **Spring Boot**
- **Spring Security**
- **Spring Data JPA**
- **MySQL** (development)
- **MySQL** (production)
- **OpenAPI / Swagger** for API documentation
- **RabbitMQ** (for notification purposes)

## Setup

### Requirements
- **Java 22**
- **Maven**
- **Docker** (optional for running services)

### Running the application

1. Clone the repository:
   ```bash
   git clone git@github.com:ErikssonHerlo/UserService-MaxiClone.git
   ```

2. Navigate to the project directory:
   ```bash
   cd UserService - MaxiClone
   ```

3. Build the project:
   ```bash
   mvn clean install
   ```

4. Run the service:
   ```bash
   mvn spring-boot:run
   ```

### Swagger UI

The User Service API documentation is available through **Swagger UI**. Once the service is running, you can access it at:

```
http://localhost:8081/swagger-ui/index.html
```

## Endpoints

### User Management

These endpoints allow **administrators** to create, update, and delete user accounts. All CRUD operations are available, and only `ADMINISTRATOR` roles have full access to user management.

#### POST `/users`
**Create a new user**

- **Description:** Allows the administrator to create a new user with his role. The `auth_code` is generated and sent to the user's email, allowing them to set their password.

#### GET `/users`
**List all users**

- **Description:** Fetches a paginated list of all users.
- **Query Params:**
    - `page`: The page number (default `0`)
    - `size`: The number of users per page (default `10`)

#### GET `/users/{email}`
**Get a specific user by email**

- **Description:** Retrieves the details of a specific user using their email address.

#### PUT `/users/{email}`
**Update user details**

- **Description:** Updates the user information. Can update fields such as `firstName`, `lastName`, `role`, etc.

#### DELETE `/users/{email}`
**Delete a user**

- **Description:** Soft-deletes a user by marking them as `deleted` (they will no longer be listed in queries).

### Reset Password

#### POST `/users/{email}/auth-code`}`
**Generate Auth Code**

- **Description:** This endpoint generates a `auth_code` for a user and sends it via email. The user can then use the `auth_code` to reset their password.

#### POST `/users/reset-password`
**Reset the password**
- **Description:** Resets the user's password using the `auth_code` that was emailed to them.
---
## Security

### JWT Authentication

All endpoints except `POST /users/reset-password-request` and `POST /users/reset-password` are secured with **JWT Bearer Tokens**. The `Authorization` header must be included in every request to access these secured endpoints.

```bash
Authorization: Bearer <token>
```

### Example

```json
{
  "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
---

This README provides a high-level overview of the **User Service** within the **MaxiClone** application, outlining the available API endpoints and their usage.

---
